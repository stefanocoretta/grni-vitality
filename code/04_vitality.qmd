---
title: "Vitality"
author: "Stefano Coretta"
format: html
---

```{r}
#| label: setup

library(tidyverse)
```

## Read data

```{r}
#| label: polentometro
polentometro_en <- readRDS("data/derived/polentometro_en.rds")

polentometro_page8 <- polentometro_en |> 
  filter(MAXPAGE > 7) |> 
  mutate(
    understand_galloit_birth = ifelse(is.na(understand_galloit_birth), as.character(understand), as.character(understand_galloit_birth)),
    understand_galloit_birth = factor(understand_galloit_birth, levels = c("No, per niente", "Sì, ma molto poco", "Così così", "Sì, lo capisco", "Sì, lo capisco molto bene")),
    speak_galloit_birth = ifelse(is.na(speak_galloit_birth), as.character(speak), as.character(speak_galloit_birth)),
    speak_galloit_birth = factor(speak_galloit_birth, levels = c("No, per niente", "Sì, ma molto poco", "Così così", "Sì, lo parlo bene", "Sì, lo parlo molto bene"))
  )
```

```{r}
polentometro_page8 |> 
  drop_na(understand_galloit_birth) |> 
  ggplot(aes(understand_galloit_birth)) +
  geom_bar() +
  coord_flip()

polentometro_page8 |> 
  drop_na(understand_galloit_birth) |> 
  filter(Region != "Veneto") |> 
  ggplot(aes(understand_galloit_birth)) +
  geom_bar() +
  coord_flip() +
  facet_wrap(vars(Region))
```

```{r}
polentometro_page8 |> 
  drop_na(speak_galloit_birth) |> 
  ggplot(aes(speak_galloit_birth)) +
  geom_bar() +
  coord_flip() +
  facet_wrap(vars(Region))

polentometro_page8 |> 
  drop_na(speak_galloit_birth) |> 
  ggplot(aes(Region, fill = speak_galloit_birth)) +
  geom_bar(position = "fill") +
  coord_flip() +
  scale_fill_brewer(type = "div")

polentometro_page8 |> 
  drop_na(speak_galloit_birth) |> 
  ggplot(aes(Area, fill = speak_galloit_birth)) +
  geom_bar(position = "fill") +
  coord_flip() +
  scale_fill_brewer(type = "div")
```

```{r}
polentometro_page8 |> 
  pivot_longer(c(languages_parents, first_langacq, spoke_to_children, children_spoke, children_speak, would_teach_children)) |> 
  drop_na(value) |> 
  filter(!(value %in% c("No_minors", "No_adult_children"))) |> 
  ggplot(aes(name, fill = value)) +
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
polentometro_page8 |> 
  pivot_longer(c(languages_parents, first_langacq, spoke_to_children, children_speak)) |> 
  drop_na(value) |> 
  filter(
    !(value %in% c("No_minors", "No_adult_children", "Neither")),
  ) |> 
  mutate(
    name = factor(name, levels = c("languages_parents", "first_langacq", "spoke_to_children", "children_speak")),
    value = factor(value, levels = c("Mostly_GI", "Equally", "Mostly_IT"))
  ) |> 
  ggplot(aes(name, fill = value)) +
  geom_bar(position = "fill") +
  theme_dark() +
  scale_fill_brewer(type = "div", palette = "RdBu") +
  labs(
    x = element_blank(), y = "Proportion", fill = "Languages spoken"
  )
```

```{r}
polentometro_page8 |> 
  pivot_longer(c(languages_parents, first_langacq, spoke_to_children, children_speak)) |> 
  drop_na(value, generation) |> 
  filter(
    !(value %in% c("No_minors", "No_adult_children", "Neither")),
  ) |> 
  mutate(
    name = factor(name, levels = c("languages_parents", "first_langacq", "spoke_to_children", "children_speak")),
    value = factor(value, levels = c("Mostly_GI", "Equally", "Mostly_IT"))
  ) |> 
  ggplot(aes(name, fill = value)) +
  geom_bar(position = "fill") +
  facet_wrap(~generation) +
  theme_dark() +
  scale_fill_brewer(type = "div", palette = "RdBu") +
  labs(
    x = element_blank(), y = "Proportion", fill = "Languages spoken"
  )
```
